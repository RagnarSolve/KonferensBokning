name: Build and Deploy Azure Functions

on:
    push:
        branches:
            - main

jobs:
    build-and-deploy:
        runs-on: windows-latest

        steps:
            - uses: actions/checkout@v3

            - name: Setup .NET
              uses: actions/setup-dotnet@v3
              with:
                  dotnet-version: "9.0.x"

            - name: Restore Dependencies
              run: dotnet restore ./KonferenscentrumVast.Functions/Functions.csproj

            - name: Build Function App
              run: dotnet build ./KonferenscentrumVast.Functions/Functions.csproj --configuration Release

            - name: Publish Function App
              run: dotnet publish ./KonferenscentrumVast.Functions/Functions.csproj --configuration Release --output ./publish

            - name: Deploy to Azure Function App
              uses: azure/functions-action@v1
              with:
                  app-name: "konferens-functionApp"
                  package: "./publish"
